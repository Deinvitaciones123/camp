<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Invitaci√≥n</title>

<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600&family=Marcellus&display=swap" rel="stylesheet" />

<style>
  :root{
    --champagne: #d7c1a3;
    --gold: #bfa275;
    --gold-deep: #a78557;
    --bg-ivory: #fffdf9;
    --text: #3b2f25;
    --ring: rgba(191,162,117,.35);
  }

  *{ box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; }

  body{
    font-family: "Marcellus", serif;
    color: var(--text);
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    background:
      linear-gradient(180deg, #faf7f2 0%, #ffffff 60%, #faf7f2 100%);
  }

  /* ======= CONTENEDOR GENERAL ======= */
  .frame-full {
    position: relative;
    width: 100%;
    height: 100vh;
    background: var(--bg-ivory);
    border: 2px solid var(--gold);
    border-radius: 16px;
    box-shadow:
      0 0 0 6px rgba(191,162,117,.08),
      inset 0 0 18px rgba(191,162,117,.15),
      0 8px 24px rgba(0,0,0,.08);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    overflow: hidden;
    padding: 16px;
  }

  /* ======= T√çTULO ======= */
  h2{
    font-family: "Cormorant Garamond", serif;
    font-weight: 600;
    color: var(--gold);
    font-size: clamp(22px, 6vw, 40px);
    margin-top: 10px;
    text-shadow: 0 0 10px rgba(191,162,117,.18);
  }

  /* ======= PREVIEW ======= */
  .preview-container{
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    overflow: hidden;
  }

  #previewBox{
    position: relative;
    background: #fffdf9;
    border-radius: 14px;
    border: 2px solid var(--gold);
    overflow: hidden;
    box-shadow:
      0 0 0 6px rgba(191,162,117,.08),
      inset 0 0 18px rgba(191,162,117,.15),
      0 8px 24px rgba(0,0,0,.08);
    width: 90%;
    max-width: 480px;
    aspect-ratio: 3/4; /* relaci√≥n vertical */
  }

  #previewBox video,
  #previewBox img{
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  /* ======= BOTONES ======= */
  #btnsContainer{
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    padding-bottom: 12px;
  }

  .btn{
    --grad: linear-gradient(145deg, var(--champagne) 0%, var(--gold) 55%, var(--gold-deep) 100%);
    background: var(--grad);
    color: #fff;
    font-weight: 600;
    letter-spacing: .2px;
    border: none;
    border-radius: 10px;
    padding: 12px 20px;
    font-size: clamp(16px, 4vw, 18px);
    cursor: pointer;
    width: 80%;
    max-width: 300px;
    box-shadow: 0 6px 14px rgba(191,162,117,.35);
    transition: transform .2s ease, box-shadow .2s ease;
  }

  .btn:hover{
    transform: translateY(-2px);
    box-shadow: 0 8px 18px rgba(191,162,117,.45);
  }

  .btn:active{
    transform: translateY(0);
    filter: brightness(.95);
  }
</style>
</head>
<body>

  <div class="frame-full">
    <h2>¬°Gracias por acompa√±arnos!</h2>

    <div class="preview-container">
      <div id="previewBox">
        <video id="video" autoplay playsinline></video>
        <img id="preview" />
      </div>
    </div>

    <div id="btnsContainer">
      <button id="fotoBtn" class="btn">üì∑ Tomar Foto</button>
      <button id="flipBtn" class="btn">üîÑ Voltear C√°mara</button>
      <button id="galleryBtn" class="btn">üñºÔ∏è Subir desde galer√≠a</button>
    </div>
  </div>

  <input id="picker" type="file" accept="image/*, video/*" multiple style="display:none" />
  <canvas id="canvas" style="display:none;"></canvas>

<script>
  const video = document.getElementById("video");
  const preview = document.getElementById("preview");
  const canvas = document.getElementById("canvas");
  const context = canvas.getContext("2d");
  const picker = document.getElementById("picker");
  const btnsContainer = document.getElementById("btnsContainer");

  let stream;
  let useFront = true;
  let uploadQueue = [];
  const ENDPOINT = "https://script.google.com/macros/s/AKfycbyWbaYdgaJnBuHOPoNugywZczy6f0yRb-w0lZkb0Py4azb0qvQl5fCnKwB-ZS-wDStjAw/exec";

  async function startCamera() {
    if (stream) stream.getTracks().forEach(t => t.stop());
    try {
      stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: useFront ? "user" : "environment" }
      });
      video.srcObject = stream;
      video.style.display = "block";
      preview.style.display = "none";
    } catch (err) {
      alert("No se pudo acceder a la c√°mara.");
    }
  }

  async function takePhoto() {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    context.drawImage(video, 0, 0);
    const imgData = canvas.toDataURL("image/png");
    preview.src = imgData;
    preview.style.display = "block";
    video.style.display = "none";
    uploadQueue = [{ data: imgData }];
    renderUploadButtons();
  }

  function renderUploadButtons() {
    btnsContainer.innerHTML = `
      <button id="uploadBtn" class="btn">‚¨ÜÔ∏è Subir</button>  
      <button id="retakeBtn" class="btn">‚Ü©Ô∏è Volver a c√°mara</button>
    `;
    document.getElementById("uploadBtn").onclick = uploadSelected;
    document.getElementById("retakeBtn").onclick = startCamera;
  }

  async function uploadSelected() {
    if (!uploadQueue.length) return alert("No hay im√°genes para subir.");
    const data = uploadQueue[0].data;
    try {
      await fetch(ENDPOINT, { method: "POST", body: JSON.stringify({ image: data }) });
      alert("¬°Imagen enviada con √©xito!");
    } catch {
      alert("Error al enviar la imagen.");
    }
  }

  document.getElementById("fotoBtn").onclick = takePhoto;
  document.getElementById("flipBtn").onclick = () => { useFront = !useFront; startCamera(); };
  document.getElementById("galleryBtn").onclick = () => picker.click();
  picker.addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      preview.src = reader.result;
      preview.style.display = "block";
      video.style.display = "none";
      uploadQueue = [{ data: reader.result }];
      renderUploadButtons();
    };
    reader.readAsDataURL(file);
  });

  startCamera();
</script>

</body>
</html>
